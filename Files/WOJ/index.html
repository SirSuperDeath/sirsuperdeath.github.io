<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link id="themeStylesheet" href="styles.css" rel="stylesheet"> 
<!-- Dark mode by default change to Style1 to make it light mode -->
<link href="/icons/favicon.png" rel="icon">
<link rel="manifest" href="/Files/WOJ/manifest.json">
<meta name="theme-color" content="#235bd3">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link href="button-switcher.css" rel="stylesheet">
<title>Missions</title>
</head>
<body>
<!-- Swap style button (top right) -->
<!--<button id="swapStyleButton" type="button" title="Swap Style" aria-label="Swap Style">
    <span id="swapStyleIcon" class="material-icons">dark_mode</span>*-->
</button>
<div class="container">
    <!-- New buttons -->
    <div class="button-container-top">
        <a href="http://tick.infomancer.uk/galtick.json" id="infoButton" class="tick-button">
            <span class="tick-icon">‚è∞</span>
            <span id="tickTime" class="tick-time">Loading...</span>
        </a>
        <a href="https://ed-server-status.orerve.net" id="serverStatusButton" class="button">
            <span id="serverStatus" class="server-status">Loading...</span>
        </a>
        <a href="https://inara.cz/elite/squadron-mission-add/380/" target="_blank">Post Mission Page</a>
        <a href="https://inara.cz/elite/minorfaction/31555/" target="_blank">Faction info Page</a>
    </div>
    <form id="wordReplacerForm">
        <input type="radio" id="predefinedInput" name="inputType" value="predefined" checked style="display: none;">
        <input type="radio" id="customInput" name="inputType" value="custom" style="display: none;">
        <label for="wordSetSelect">Mission type:</label>
        <small style="display:block; margin-bottom:8px; color:gray;">
            Link Reference: <code>?type=1&amp;system=Jonai&amp;supporting=&amp;pending=0</code>
        </small>
        <select id="wordSetSelect"></select>
        <textarea id="customTextInput" placeholder="Enter custom text..." style="display: none;"></textarea>
        <div class="checkbox-container">
            <input type="checkbox" id="pendingCheckbox">
            <label for="pendingCheckbox">Tick the box if the Mission is Pending</label>
        </div>
        <!-- Flex container for search word and replace word input -->
        <div class="flex-container">
             <!-- Remove  display: none; if you wish to add it back -->
            <div class="flex-item" style="display: none;">
               <label for="searchWordSelect1">Replacing System Name:</label>
                <select id="searchWordSelect1">
                    <option value="{systemname}">System Name</option>
                    <!--<option value="custom">Custom Word...</option>-->
                </select>
            </div>
            <div class="flex-item">
                <label for="replaceWord1">What system</label>
                <input type="text" id="replaceWord1" placeholder="Where is the mission taking place?" required list="systemList">
                <datalist id="systemList"></datalist>
            </div>
        </div>
        <div class="flex-container">
             <!-- Remove  display: none; if you wish to add it back -->
            <div class="flex-item" style="display: none;">
                <label for="searchWordSelect2">Replacing Faction Name:</label>
                <select id="searchWordSelect2">
                    <option value="{factionname}">Faction Name</option>
                    <!--<option value="custom">Custom Word...</option>-->
                </select>
            </div>
            <div class="flex-item">
                <label for="replaceWord2">Supporting who</label>
                <input type="text" id="replaceWord2" placeholder="Wolves Of Jonai">
            </div>
        </div>
        <input type="text" id="searchWord" placeholder="Enter Custom Word..." style="display: none;">
        <div class="button-container-bottom">
            <button type="submit">Make mission for copy</button>
        </div>
    </form>
    <div id="notification" style="display:none;"></div>
    <div class="button-container-bottom">
        <button id="copyTitleButton" class="toggle-button">Copy Mission Title</button>
        <button id="copyButton" class="toggle-button">Copy Mission Text</button>
        <button id="copySystemNameButton" class="toggle-button">Copy System Name</button>
    </div>
    <div id="output"></div>
    <div id="titleOutput"></div>  
</div>
<script src="script.js"></script>
<script src="button-switcher.js"></script>
<script>
  function getQueryParams() {
    const params = {};
    window.location.search.substring(1).split("&").forEach(pair => {
      const [key, value] = pair.split("=");
      if (key) params[decodeURIComponent(key.toLowerCase())] = decodeURIComponent(value || "");
    });
    return params;
  }

  // Wait for missions to be loaded before applying URL params
  document.addEventListener('missionsLoaded', function() {
    const params = getQueryParams();

    if (params.system) {
      document.getElementById('replaceWord1').value = params.system;
    }
    if (params.supporting) {
      document.getElementById('replaceWord2').value = params.supporting;
    }
    if (params.type) {
      const select = document.getElementById('wordSetSelect');
      for (let i = 0; i < select.options.length; i++) {
        if (select.options[i].value === params.type) {
          select.selectedIndex = i;
          break;
        }
      }
    }
    if (params.pending === "1") {
      document.getElementById('pendingCheckbox').checked = true;
    } else {
      document.getElementById('pendingCheckbox').checked = false;
    }
    if (params.system && params.type) {
      setTimeout(() => {
        document.getElementById('wordReplacerForm').dispatchEvent(new Event('submit', {cancelable: true, bubbles: true}));
      }, 100); // Shorter delay, missions are loaded
    }
  });

  // Patch script.js to dispatch 'missionsLoaded' after dropdown is populated
</script>
</body>
</html>